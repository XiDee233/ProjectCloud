# 游戏开局流程修复方案

## 问题分析
1. **类名错误**：GameManager中引用了`SteamRoomManager`，但实际类名是`SteamRoomSystem`
2. **流程问题**：当前GameManager在Awake时就初始化SteamRoomSystem，不符合主菜单 -> 开始游戏 -> 选择/创建房间 -> 加入房间的流程
3. **缺少清晰接口**：没有提供符合流程的函数调用，UI无法正确调用
4. **协调问题**：NetworkManager的调用和玩家生成需要协调，确保状态正确

## 解决方案

### 1. 修复GameManager中的类名错误
- 将`SteamRoomManager`改为`SteamRoomSystem`

### 2. 重新设计GameManager流程
- 移除Awake中的SteamRoomSystem初始化
- 添加符合主菜单 -> 开始游戏 -> 选择/创建房间 -> 加入房间的流程函数
- 协调NetworkManager状态和玩家生成

### 3. 提供清晰的函数接口

#### GameManager类
1. **`public void StartGame()`** - 从主菜单开始游戏，初始化Steam连接
2. **`public void CreateGameRoom(string roomName, int maxPlayers = 10)`** - 创建游戏房间
3. **`public void GetAvailableRooms()`** - 获取可用房间列表
4. **`public void JoinGameRoom(Steam.SteamRoomSystem.SteamRoomInfo roomInfo)`** - 加入指定房间
5. **`public void ExitGame()`** - 退出游戏

#### NetworkManager协调
- 确保NetworkManager只在需要时启动客户端
- 玩家生成只在成功加入房间后进行
- 场景加载与NetworkManager状态协调

### 4. 调整初始化时机和协调机制

#### 流程协调
1. **主菜单阶段**：
   - GameManager正常初始化，但不初始化SteamRoomSystem
   - NetworkManager处于断开状态

2. **开始游戏阶段**：
   - 调用`StartGame()`
   - 初始化SteamRoomSystem
   - 连接到Steam
   - NetworkManager仍然处于断开状态

3. **选择/创建房间阶段**：
   - 调用`GetAvailableRooms()`获取房间列表
   - 或调用`CreateGameRoom()`创建房间
   - NetworkManager仍然处于断开状态

4. **加入房间阶段**：
   - 调用`JoinGameRoom()`
   - SteamRoomSystem处理加入逻辑
   - 成功加入后，NetworkManager启动客户端
   - NetworkManager在客户端连接成功后处理玩家生成
   - 加载游戏场景

### 5. 实现关键协调点

#### NetworkManager事件监听
- 监听`onClientConnectionState`事件
- 当连接状态变为`Connected`时，处理玩家生成
- 确保场景加载与玩家生成协调

#### 场景加载协调
- 只有在成功加入房间后，才加载游戏场景
- 场景加载完成后，通知NetworkManager生成玩家

## 实现步骤
1. 修复GameManager中的类名错误
2. 移除GameManager.Awake()中的SteamRoomSystem初始化
3. 添加符合流程的公共函数
4. 实现NetworkManager和玩家生成的协调机制
5. 确保SteamRoomSystem的函数与GameManager的函数正确对接
6. 测试流程的正确性

## 预期结果
- 用户可以通过UI调用GameManager的函数，按照主菜单 -> 开始游戏 -> 选择/创建房间 -> 加入房间的流程进行游戏
- NetworkManager状态与游戏流程正确协调
- 玩家生成只在成功加入房间后进行
- 场景加载与NetworkManager状态协调
- 不需要关心UI实现，只需要调用对应的函数
- 流程清晰，符合玩家预期